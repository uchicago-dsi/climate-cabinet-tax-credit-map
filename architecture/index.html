
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../datasets/clean-datasets/">
      
      
        <link rel="next" href="../infrastructure/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>Architecture - Climate Cabinet - Tax Credit Bonus Map Widget</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Climate Cabinet - Tax Credit Bonus Map Widget" class="md-header__button md-logo" aria-label="Climate Cabinet - Tax Credit Bonus Map Widget" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Climate Cabinet - Tax Credit Bonus Map Widget
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../getting-started/" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../datasets/" class="md-tabs__link">
          
  
    
  
  Datasets

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Architecture

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../infrastructure/" class="md-tabs__link">
        
  
    
  
  Infrastructure

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Climate Cabinet - Tax Credit Bonus Map Widget" class="md-nav__button md-logo" aria-label="Climate Cabinet - Tax Credit Bonus Map Widget" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Climate Cabinet - Tax Credit Bonus Map Widget
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../datasets/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Datasets
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../datasets/raw-datasets/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Raw Datasets
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Raw Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/raw-datasets/bonus-geographies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bonus Geographies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/raw-datasets/census-geographies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Census Geographies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/raw-datasets/retail-geographies/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Retail Geographies
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets/clean-datasets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Clean Datasets
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-storage" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases" class="md-nav__link">
    <span class="md-ellipsis">
      Databases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-app" class="md-nav__link">
    <span class="md-ellipsis">
      Web App
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tileset-server" class="md-nav__link">
    <span class="md-ellipsis">
      Tileset Server
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#file-storage" class="md-nav__link">
    <span class="md-ellipsis">
      File Storage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases" class="md-nav__link">
    <span class="md-ellipsis">
      Databases
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-app" class="md-nav__link">
    <span class="md-ellipsis">
      Web App
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tileset-server" class="md-nav__link">
    <span class="md-ellipsis">
      Tileset Server
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="architecture">Architecture</h1>
<p>The application has five main components:</p>
<h2 id="file-storage">File Storage</h2>
<p>A file system used to store raw, cleaned, and test datasets as well as Mapbox tileset metadata. It uses the following directory structure:</p>
<pre><code>├── clean/
│   ├── geojsonl/
│   ├── geoparquet/
│   └── mapbox/
├── raw/
│   ├── bonus/
│   │   ├── distressed/
│   │   ├── energy/
│   │   ├── justice40/
│   │   └── low_income/
│   ├── census/
│   │   ├── block_groups/
│   │   ├── blocks/
│   │   ├── counties/
│   │   ├── county_subdivisions/
│   │   ├── government_units/
│   │   ├── places/
│   │   ├── states/
│   │   ├── tracts/
│   │   └── zip_codes/
│   └── retail/
└── test/
</code></pre>
<p>Detailed descriptions of each directory's contents can be found in the <strong><a href="/datasets">Datasets section</a></strong>.</p>
<h2 id="databases">Databases</h2>
<p>Two PostgreSQL database instances—a temporary, "large" database for caching geospatial data during pipeline processing and a "small", less expensive database to serve the final website. PostgreSQL was chosen as the database engine because it is free and open source with a large and active community of contributors. In addition, it is easy to run both locally as a Docker container and as a service on a cloud platform. The application installs PostgreSQL's PostGIS extension to store multipolygon geometries and run spatial queries and its trigram extension to calculate the relevance of search results.</p>
<p>Two tables are defined in the larger database, populated with data, and then replicated to the smaller database after all geometries have been simplified to their final form. The table schemas are as follows:</p>
<p><strong><code>public.tax_credit_geography</code></strong></p>
<p>A table storing geographies available for user search and/or reporting. A unique constraint exists on the combination of the <code>name</code>, <code>fips</code>, and <code>geography type</code> fields.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Ever Blank or Null?</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>bigint</td>
<td>The primary key.</td>
<td>NO</td>
<td><code>1760</code></td>
</tr>
<tr>
<td>name</td>
<td>character varying</td>
<td>The geography name.</td>
<td>NO</td>
<td><code>"LORAIN COUNTY, OHIO"</code></td>
</tr>
<tr>
<td>fips</td>
<td>character varying</td>
<td>The FIPS code assigned to the geography, if applicable.</td>
<td>YES, BLANK</td>
<td><code>39093</code></td>
</tr>
<tr>
<td>fips_pattern</td>
<td>character varying</td>
<td>Explains how to interpret the FIPS code.</td>
<td>YES, BLANK</td>
<td><code>"STATE(2) + COUNTY(3)"</code></td>
</tr>
<tr>
<td>geography_type</td>
<td>character varying</td>
<td>The type of geography, from a limited set of choices.</td>
<td>NO</td>
<td><code>"county"</code></td>
</tr>
<tr>
<td>population</td>
<td>integer</td>
<td>The estimated population for the geography.</td>
<td>YES, NULL</td>
<td>312964</td>
</tr>
<tr>
<td>population_strategy</td>
<td>character varying</td>
<td>The method used to derive the population estimate.</td>
<td>YES, BLANK</td>
<td><code>"FIPS Code Match"</code></td>
</tr>
<tr>
<td>as_of</td>
<td>date</td>
<td>The date on which the geography's data source became current.</td>
<td>NO</td>
<td><code>2020-01-01</code></td>
</tr>
<tr>
<td>published_on</td>
<td>date</td>
<td>The publication date of the geography's data source.</td>
<td>YES, NULL</td>
<td><code>2021-02-02</code></td>
</tr>
<tr>
<td>source</td>
<td>text</td>
<td>A citation for the geography's data source.</td>
<td>NO</td>
<td><code>"2020 TIGER/Line Shapefiles, U.S. Census Bureau"</code></td>
</tr>
<tr>
<td>programs</td>
<td>jsonb</td>
<td>A generated field consisting of the tax credit programs the geography qualifies for based on type. Only relevant for bonus geographies.</td>
<td>NO</td>
<td><code>[]</code></td>
</tr>
<tr>
<td>geometry</td>
<td>geometry</td>
<td>The geography boundary as a hex string. In the large database, the geometry's exterior. In the smaller database, its bounding box.</td>
<td>NO</td>
<td><code>01060000206....</code></td>
</tr>
<tr>
<td>name_vector</td>
<td>tsvector</td>
<td>A sorted list of lexemes parsed from the name field. Used to optimize text search.</td>
<td>NO</td>
<td><code>'counti':2 'lorain':1 'ohio':3</code></td>
</tr>
</tbody>
</table>
<p><strong><code>public.tax_credit_target_bonus_overlap</code></strong></p>
<p>An association table relating "target" geographies—again, states, counties, municipalities, municipal utilities, and rural cooperatives—with the bonus territories—i.e., distressed, low-income, energy, and Justice40 communities—that spatially intersect with them. Additional metadata includes an estimate of the number of people living in the intersection.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Field</th>
<th>Description</th>
<th>Ever Blank or Null?</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>integer</td>
<td>The primary key.</td>
<td>NO</td>
<td><code>4013</code></td>
</tr>
<tr>
<td>target_id</td>
<td>bigint</td>
<td>Foreign key reference to a "target" geography.</td>
<td>NO</td>
<td><code>1760</code></td>
</tr>
<tr>
<td>bonus_id</td>
<td>bigint</td>
<td>Foreign key reference to a "bonus" geography (e.g., distressed, low-income, Justice 40, energy communities, etc.).</td>
<td>NO</td>
<td><code>5727</code></td>
</tr>
<tr>
<td>population</td>
<td>integer</td>
<td>The number of people estimated to live in the intersection between the target and bonus geographies.</td>
<td>NO</td>
<td><code>61390</code></td>
</tr>
<tr>
<td>population_strategy</td>
<td>character varying</td>
<td>The method used to derive the population estimate.</td>
<td>NO</td>
<td><code>"Population-Weighted Block Group Centroid Spatial Join"</code></td>
</tr>
</tbody>
</table>
<h2 id="pipeline">Pipeline</h2>
<p>A Django application that consists of several standard and custom <strong><a href="https://docs.djangoproject.com/en/5.0/howto/custom-management-commands/">Django management commands</a></strong>. When triggered, a bash script in the pipeline—</p>
<ol>
<li>
<p><strong>Connects to the PostgreSQL Database.</strong> The pipeline attempts to connect to the database. If it fails, it retries on an interval until a maximum number of seconds has elapsed—at which point it throws an error.</p>
</li>
<li>
<p><strong>Creates New Migrations.</strong>  The pipeline runs <code>manage.py makemigrations</code> to detect any changes in the Django ORM models. If a model class has changed, a new migration file is written under the <code>pipeline/tax_credit/migrations</code> folder to later move to the updated schema.</p>
</li>
<li>
<p><strong>Migrates Schemas.</strong> The pipeline runs <code>manage.py migrate</code> to apply any newly-detected migration file(s) to the database. The first time the application runs, this operation creates the <code>tax_credit_geography</code> and <code>tax_credit_bonus_target_overlap</code> tables as well as a custom tsvector index on the <code>tax_credit_geography.name</code> column, and installs of the trigram extension. </p>
</li>
<li>
<p><strong>Loads and Cleans Input Data Files.</strong> After the tables and indices have been created, the pipeline runs <code>manage.py clean_data</code>. This custom command reads raw input files from the configured data store, cleans and standardizes the data to conform to the <code>tax_credit_geography</code> table schema described above, and then writes the resulting output geographies to the data store as geoparquet and geojsonl files.</p>
</li>
<li>
<p><strong>Loads Geographies.</strong> The pipeline then runs <code>manage.py load_geos</code>. This custom command reads each cleaned geoparquet file from the data store one by one and bulk inserts its records into the <code>tax_credit_geography</code> database table, <em>ignoring unique constraint violations when they occur</em>.</p>
</li>
<li>
<p><strong>Load Associations.</strong> Once the geographies are loaded, the pipeline runs <code>manage.py load_associations</code>. This custom command computes spatial intersections between all combinations of target and bonus geography types and estimates the number of persons living in those intersections. The population estimation is achieved by matching geographies on a common state or county FIPS code when possible, or by summing the populations of census block group population-weighted centroids that fall into the intersections. Finally, the association records are mapped to the schema for the <code>tax_credit_target_bonus_overlap</code> table outlined above and bulk inserted into the database.</p>
</li>
<li>
<p><strong>Sync Tilesets.</strong> Finally, the pipeline runs <code>manage.py sync_tilesets</code>, which syncs the remote Mapbox tilesets with the tilesets defined by the cleaned geojsonl files and configuration settings. Steps include deleting all pre-existing tileset sources for the given Mapbox account, uploading the geojsonl files as new sources, publishing the sources as new tilesets, and awaiting the completion of the publishing job.</p>
</li>
</ol>
<h2 id="web-app">Web App</h2>
<p>A JavaScript-based, <strong><a href="https://nextjs.org/">Next.js</a></strong> web application that reads directly from the database to (a) conduct user geography searches and (b) return reports of available tax credit programs, intersecting bonus communities, and population counts for those geographies. <strong><a href="https://www.prisma.io/">Prisma</a></strong> is used as an ORM and <strong><a href="https://tailwindcss.com/">Tailwind</a></strong> as a CSS framework. Once a geography is selected, the web app requests those geographies' tiles from an external tileset server and displays those tiles on a <strong><a href="https://visgl.github.io/react-map-gl/">React Map GL</a></strong> component with styling.</p>
<h2 id="tileset-server">Tileset Server</h2>
<p>Requesting hundreds of large and complex geometries at once from the database and serializing the result as GeoJSON to be displayed on a map quickly proved to be infeasible. The network transfer time was slow enough to harm the user experience and large states like California required too much memory for the browser. To mitigate these issues, the application renders geographies using tilesets. <strong><a href="https://docs.mapbox.com/api/overview/">Mapbox</a></strong> was selected as the server based on its community support, generous free tier, and integration with popular React component libraries like <code>react-map-gl</code>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../datasets/clean-datasets/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Clean Datasets">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Clean Datasets
              </div>
            </div>
          </a>
        
        
          
          <a href="../infrastructure/" class="md-footer__link md-footer__link--next" aria-label="Next: Infrastructure">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Infrastructure
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.indexes", "navigation.footer", "navigation.expand"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
    
  </body>
</html>